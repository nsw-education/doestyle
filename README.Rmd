---
output: 
  md_document:
    variant: gfm
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "./man/figures/README-",
  out.width = "100%"
)
```

# doestyle

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

`{doestyle}` is an R package containing functions to help produce brand-compliant figures and tables for NSW Department of Education publications. It is currently under active development, but already includes features that ease the use of brand colours and typesetting in `ggplot2` figures and `flextable` tables.

## Installation

`doestyle` can be installed with R's standard `install.packages()` function. Because `doestyle` is not yet on CRAN, you will need to install its dependencies first, by following the instructions below.

To install `doestyle` run both of the following commands in your R console:

```{r echo=FALSE, results='asis'}
cat(
  "``` r\n",
  "# Install doestyle's dependencies from CRAN:\n",
  "install.packages(c(",
  paste0("\"", remotes::local_package_deps(), "\"", collapse = ", "),
  "),\n",
  "   type = \"binary\")\n",
  "# Install doestyle from its URL:\n",
  "install.packages(\"https://bitbucket.org/nsw-education/doestyle/downloads/doestyle_latest.tar.gz\",\n",
  "   type = \"source\")\n",
  "```",
  sep = ""
)
```
If you're using RStudio on Windows and it prompts you to restart R before installing, select "No" - there is a [known RStudio issue](https://github.com/rstudio/rstudio/issues/2656) around reinstalling packages on Windows.

The same commands can be used to update your installed version of `doestyle` if needed.

## Usage example

Apply the department's colour palette to the fill aesthetic of a bar chart:

```{r example, warning = FALSE, message = FALSE, fig.width=7, fig.height=5, out.width="800px"}
library(ggplot2)
# Load doestyle
library(doestyle)

diamonds |>
  ggplot(aes(x = cut, fill = cut)) +
  geom_bar() +
  # Use the DoE fill scale
  scale_fill_doe() + 
  # Apply the DoE theme
  theme_doe()
```

The department has several different palettes available, which have been constructed from the official colours.  These are displayed below. The default palette should be used when possible.

```{r show-palettes, echo=FALSE, warning = FALSE, message = FALSE, fig.width=9, fig.height=7, out.width="800px"}
library(data.table)
library(ggplot2)
palettes <- c("default", "baby_blue_red", "navy_red", "light_shades",
              "two_blues", "three_color", "red_to_blue")

sPalette <- palettes |>
  sapply(function(x) doe_pal(palette = x)(8)) |>
  as.vector()

dt <- copy(diamonds)
setDT(dt)
dt <- dt[, .(N = .N), by = .(cut, clarity)][order(cut, clarity)]
dtt <- copy(dt)
dtt[, cut := paste0(cut, 2)]
dt <- rbindlist(list(dt[!cut == "Fair"], dtt[!cut == "Fair2"]))
dt <- dt[!cut == "Good"]
dt[, N := rep(dt[cut == "Very Good", N], 7)]
dt[N == 84, N := 1248]

dt |>
  ggplot(aes(x = cut, y = N, fill = interaction(clarity, cut, sep = " - "))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = sPalette, guide = "none") +
  scale_x_discrete(labels = palettes) +
  xlab(label = NULL) +
  ylab(label = NULL) +
  labs(title = "DoE Palettes") +
  theme_doe()

```
